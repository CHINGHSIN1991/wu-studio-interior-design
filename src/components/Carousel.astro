---
import { Image } from "astro:assets"
import type { CarouselItem } from "../../types"

const { items } = Astro.props as { items: CarouselItem[] };
---

<div class="w-100vw h-100vh m-0 relative overflow-hidden">
  <div class="relative w-full h-full">
    {
      items.map((item: CarouselItem, index: number) => {
        return (
          <div class={`carousel-item absolute top-0 left-0 w-full h-full transition-opacity duration-800 ease-in-out ${index === 0 ? 'opacity-100' : 'opacity-0'}`}>
            {item.data.link ? (
              <a href={`projects/${item.data.link}`}>
                <Image
                  src={item.data.image} 
                  alt={item.data.title}
                  width="1200"
                  height="600"
                  format="avif"
                  fit="cover"
                  quality={80}
                  class="w-full h-full object-cover"
                />
              </a>
            ) : (
              <Image
                src={item.data.image} 
                alt={item.data.title}
                width="1200"
                height="600"
                format="avif"
                fit="cover"
                quality={80}
                class="w-full h-full object-cover"
              />
            )}
            <div class="absolute bottom-0 left-0 right-0 p-8 bg-gradient-to-t from-black/70 to-transparent text-white">
              <h2 class="text-4xl mb-4">{item.data.title}</h2>
              <p class="text-lg">{item.data.description}</p>
            </div>
          </div>
        )
      })
    }
    <button class="prev absolute top-1/2 -translate-y-1/2 bg-black/30 text-white border-none px-6 py-8 cursor-pointer text-2xl transition-bg duration-300 hover:bg-black/60 z-2 left-8">❮</button>
    <button class="next absolute top-1/2 -translate-y-1/2 bg-black/30 text-white border-none px-6 py-8 cursor-pointer text-2xl transition-bg duration-300 hover:bg-black/60 z-2 right-8">❯</button>
  </div>
</div>

<script>
  function setupCarousel() {
    const items = document.querySelectorAll('.carousel-item');
    const prevBtn = document.querySelector('.prev');
    const nextBtn = document.querySelector('.next');
    let currentIndex = 0;

    function showSlide(index: number) {
      items.forEach((item) => {
        (item as HTMLElement).style.opacity = '0';
        (item as HTMLElement).style.zIndex = '0';
      });
      (items[index] as HTMLElement).style.opacity = '1';
      (items[index] as HTMLElement).style.zIndex = '1';
    }

    function nextSlide() {
      currentIndex = (currentIndex + 1) % items.length;
      showSlide(currentIndex);
    }

    function prevSlide() {
      currentIndex = (currentIndex - 1 + items.length) % items.length;
      showSlide(currentIndex);
    }

    let interval = setInterval(nextSlide, 5000);

    const carousel = document.querySelector('.carousel');
    carousel?.addEventListener('mouseenter', () => clearInterval(interval));
    carousel?.addEventListener('mouseleave', () => {
      interval = setInterval(nextSlide, 5000);
    });

    prevBtn?.addEventListener('click', prevSlide);
    nextBtn?.addEventListener('click', nextSlide);
  }

  document.addEventListener('DOMContentLoaded', setupCarousel);
  document.addEventListener('astro:page-load', setupCarousel);
</script> 